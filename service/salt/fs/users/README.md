# olympus user structure

Several categories of users exist under olympus. Different management steps
apply to the different types of users.

Broadly speaking, users are defined as internal or external.

Note that many of the following details can be deduced by examining the
relevant state file for users. See "service/salt/fs/users.sls" in this
repository.

## Internal users

Internal users appear in [SaltStack pillar](https://docs.saltproject.io/en/latest/topics/tutorials/pillar.html)
in **users.sls**. This pillar file contains only two stanzas:

* **groups**. Defines system groups that exist on all servers. Each group
imparts specific privileges which are detailed in users.sls.

* **users**. The complete list of users added beyond those created by
the core Debian installation or added packages.

Since olympus is built on Debian, these designations should be understood to
refer to the group/user Linux hierarchy system. 

### Unprivileged

A typical pillar entry for an unprivileged user might be as follows:

```
someuser:
  class: human
  comment: Some person
  createhome: True
  email_address: some.olympus.user@gmail.com
  fullname: Some User
  groups:
    - clientcert
    - servercert
  redis:
    keys:
      - securities:equities
    password: {{ salt['cmd.shell'](random_password_generator) }}
  restapi:
    password: {{ salt['cmd.shell'](random_password_generator) }}
    routes:
      /equities/:
        - GET
      /token/equities/:
        - GET
  ssh_public_key: ssh-ed25519 AAAAsNzDpSDMoLPhX6FeepkwOfud8VswKjYD2T6dotreJi29eUBxvCLwq0Pk7l5xdSaz some.olympus.user@gmail.com
  vimuser: True
```

The various definitions have the following functions:

* **class**. Identifies this type of user as a human. For documentation
purposes.
* **comment**. Informative details. Optional.
* **createhome**. When set to "True", this will create a home directory for the
user on every olympus server.
* **email_address**. Contact email address. Changes to this address require
an update in salt pillar. To change 
* **fullname**. The user's proper name. For documentation purposes.
* **groups**. Adds user membership to the listed groups under Linux. By
default, the only group added will be the user's own group, which matches the
user ID.
* **redis**. Enables redis access on the local server. A *password*
specification is **mandatory**. In order to comply with system security
standards, this password should be randomly generated by SaltStack. The
specification shown above fulfills this requirement. Running the
*security.sls* state file will update these passwords for all users on each
targeted server. If **createhome** is set to **True**, a copy of the
updated password gets placed in the user's home directory at 
*~/etc/redis_password*. To limit the keys avaiable to the user, define
these are shown above under the *keys* specification. Without the *keys*
limitation, a local redis user will have **only** have access to keys
prefixed with the user's ID, which is the default access iand is available to
all users with redis access.
* **restapi**. Enables access to the REST back end. As with the *redis* 
specification, a password is required and follows the same rules.
*TODO TO BE CONTINUED ...*

In addition, the following future designations are foreseen:

* **disable: True**. Maintains the user's account on the system, including user
directories, but removes user access. This means that added groups are 
removed, the contents of ~/.ssh are deleted, access to redis and the backend
API is revoked, and the user will no longer have access to the web UI.
* **delete: True**. Completely scrubs the user from olympus, including the
contents of all user directories.

### Staff

As the name implies, **staff** users are system administrators. A typical entry
in pillar for such a user can look almost the same as for an unprivileged user
*except* for the following differences:

```
staffuser:
  ...
  is_staff: True
  ...
  original_interface_password: S0meranD0mP4sSw0Rd
  ...
```

**is_staff**. Identifies the user as an administrator. This has numerous
side effects:

* The user will have supervisor and staff privileges on the web UI.
* Enables sudoers privileges on all servers that contain a home directory for
the user.
* Enables git access, meaning that the user will have code development
privileges.
* Enables redis access on all servers, including read/write access to all
keys. A password is still required.

**original_interface_password**. An initial password used when created a staff
user account for accessing the web UI. For security, a member of the staff is
encouraged to change this password immediately upon first login. *This 
suggestion will shortly become an enforced requirement*. Without this
specification, the initial UI password will be randomly assigned, which is
probably undesirable as the password would then be unknown and therefore
unusable. Note that the password can still be set with Django's management
command-line interface using *manage.py* and the *verifyuser* option.

Also, be aware of the following:

* Staff users are automatically able to access all keys in redis.
### System

This class of user 

```
  olympus:
    class: system
    createhome: True
    fullname: Olympus system run user
    groups:
      - clientcert
    mongodb:
      roles:
        - equities: readWrite
        - user:olympus: readWrite
    redis:
      keys:
        - securities:equities
      password: {{ salt['cmd.shell'](random_password_generator) }}
    restapi:
      password: {{ salt['cmd.shell'](random_password_generator) }}
      routes:
        /equities/:
          - GET
        /token/equities/:
          - GET
    server:
      - interface
      - supervisor
      - unified
      - worker
    shell: /bin/false
```

```
    mongodb:
      admin: True
    ...
    edit_precommand: sed -i 's/\/var\/lib\/redis/\/home\/redis/' /etc/passwd
   ...
```

* **class**. Identifies this type of user as a non-human. For documentation
purposes.

## External users

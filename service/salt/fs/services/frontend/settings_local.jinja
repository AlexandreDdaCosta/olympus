{% set trim_blocks=True -%}
{# Template for django local settings.  Managed by the supervisor. -#}
"""
Django settings for the Olympus local environment
"""

# SECURITY WARNING: keep the secret key used in production secret!

SECRET_KEY = '{{ pillar['random_key']['django_secret_key'] }}'
ALLOWED_HOSTS = ['*']

# SECURITY WARNING: don't run with debug turned on in production!

{% if grains.get('stage') and grains['stage'] == 'develop' -%}
DEBUG = True
TEMPLATES = []
TEMPLATES[0]['OPTIONS']['debug'] = True
THUMBNAIL_DEBUG = True
{%- endif %}

# Database

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
{%- for host, hostinfo in salt['mine.get']('*', 'grains.items').items() -%}
{%- if 'server' in hostinfo and hostinfo['server'] == 'supervisor' -%}
{%- for ip in  hostinfo['ipv4'] -%}
{%- if ip != '127.0.0.1' %}
        'HOST': '{{ ip }}',
{%- endif -%}
{%- endfor %}
{%- endif -%}
{%- endfor %}
        'NAME': 'app_data',
        'OPTIONS': { 'sslmode': 'require' },
        'PASSWORD': '{{ pillar['random_key']['frontend_db_key'] }}',
        'PORT': '5432',
        'USER': '{{ pillar['frontend-user'] }}',
    },
    'users': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
{%- for host, hostinfo in salt['mine.get']('*', 'grains.items').items() -%}
{%- if 'server' in hostinfo and hostinfo['server'] == 'supervisor' -%}
{%- for ip in  hostinfo['ipv4'] -%}
{%- if ip != '127.0.0.1' %}
        'HOST': '{{ ip }}',
{%- endif -%}
{%- endfor %}
{%- endif -%}
{%- endfor %}
        'NAME': 'user_data',
        'OPTIONS': { 'sslmode': 'require' },
        'PASSWORD': '{{ pillar['random_key']['frontend_db_key'] }}',
        'PORT': '5432',
        'USER': '{{ pillar['frontend-user'] }}',
    }
}
